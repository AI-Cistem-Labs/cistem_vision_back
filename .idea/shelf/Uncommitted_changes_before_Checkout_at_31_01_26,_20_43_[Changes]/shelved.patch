Index: app.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+># app.py\nfrom flask import Flask, send_from_directory\nfrom flask_cors import CORS\nfrom extensions import socketio\nfrom dotenv import load_dotenv\nimport os\n\n# Cargar variables de entorno\nload_dotenv()\n\n# Crear aplicación Flask con carpeta static\napp = Flask(__name__, static_folder='static')\napp.config['SECRET_KEY'] = os.getenv('JWT_SECRET', 'cistem_secret_key_2025')\n\n# Configurar CORS\nCORS(app, resources={\n    r\"/*\": {\n        \"origins\": \"*\",\n        \"methods\": [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"],\n        \"allow_headers\": [\"Content-Type\", \"Authorization\"]\n    }\n})\n\n# Inicializar SocketIO con la app\nsocketio.init_app(\n    app,\n    cors_allowed_origins=\"*\",\n    async_mode='threading',\n    ping_timeout=60,\n    ping_interval=25\n)\n\n# Importar controladores (esto registra los eventos)\nprint(\"\uD83D\uDCE1 Registrando controladores SocketIO...\")\nimport controllers.auth_controller\nimport controllers.station_controller\nimport controllers.logs_controller\nimport controllers.alerts_controller\nimport controllers.camera_controller\nimport controllers.video_controller \nprint(\"✅ Controladores registrados\\n\")\n\n\n# Evento de conexión\n@socketio.on('connect')\ndef handle_connect():\n    print(\"\uD83D\uDD0C Cliente conectado\")\n\n\n@socketio.on('disconnect')\ndef handle_disconnect():\n    print(\"\uD83D\uDD0C Cliente desconectado\")\n\n\n# ============================================================\n# RUTAS HTTP\n# ============================================================\n\n@app.route('/')\ndef index():\n    \"\"\"Ruta raíz con información del servicio\"\"\"\n    return {\n        'service': 'Cistem Vision Backend',\n        'version': '1.1',\n        'status': 'running',\n        'protocol': 'SocketIO'\n    }\n\n\n@app.route('/health')\ndef health():\n    \"\"\"Endpoint de health check\"\"\"\n    from config.config_manager import device_config\n    from modules.vision.processors import get_available_processors\n\n    device_info = device_config.get_device_info()\n    processors = get_available_processors()\n\n    return {\n        'status': 'healthy',\n        'device': device_info,\n        'processors_count': len(processors),\n        'processors': list(processors.keys())\n    }\n\n\n# ============================================================\n# NUEVA RUTA: SERVIR MAPAS\n# ============================================================\n@app.route('/home/nix/PycharmProjects/cistem_vision_back/static/maps/mapanix.jpeg')\ndef serve_map(filename):\n    \"\"\"\n    Sirve imágenes de mapas desde static/maps/\n\n    Ejemplo de uso:\n    http://localhost:5000/static/maps/laboratorio_principal.png\n    \"\"\"\n    try:\n        return send_from_directory('static/maps', filename)\n    except FileNotFoundError:\n        return {'error': 'Mapa no encontrado'}, 404\n\n\n# ============================================================\n# INICIAR SERVIDOR\n# ============================================================\n\nif __name__ == '__main__':\n    PORT = int(os.getenv('PORT', 5000))\n    DEBUG = os.getenv('DEBUG', 'True').lower() == 'true'\n\n    print(\"=\" * 60)\n    print(\"\uD83C\uDFA5 CISTEM VISION BACKEND v1.1\")\n    print(\"=\" * 60)\n    print(f\"\uD83D\uDE80 Servidor iniciando en puerto {PORT}\")\n    print(f\"\uD83D\uDC1B Modo debug: {DEBUG}\")\n    print(f\"\uD83D\uDCE1 Protocolo: SocketIO\")\n    print(\"=\" * 60)\n    print()\n\n    # Cargar configuración del dispositivo\n    from config.config_manager import device_config\n\n    device_info = device_config.get_device_info()\n    location_info = device_config.get_location_info()\n    cameras = device_config.get_cameras()\n\n    print(f\"\uD83D\uDCF1 Dispositivo: {device_info['label']} (ID: {device_info['device_id']})\")\n    print(f\"\uD83D\uDCCD Ubicación: {location_info['label']}\")\n    print(f\"\uD83D\uDCF9 Cámaras configuradas: {len(cameras)}\")\n\n    # Mostrar procesadores disponibles\n    from modules.vision.processors import get_available_processors\n\n    processors = get_available_processors()\n    print(f\"\uD83E\uDD16 Procesadores disponibles: {len(processors)}\")\n    for proc_id, proc_info in processors.items():\n        print(f\"   - [{proc_id}] {proc_info['label']}\")\n\n    print()\n    print(\"=\" * 60)\n    print(f\"✅ Servidor listo en http://localhost:{PORT}\")\n    print(f\"✅ WebSocket en ws://localhost:{PORT}\")\n    print(f\"\uD83D\uDDFA\uFE0F  Mapas en http://localhost:{PORT}/static/maps/\")\n    print(\"=\" * 60)\n    print()\n\n    # Iniciar servidor\n    socketio.run(\n        app,\n        host='0.0.0.0',\n        port=PORT,\n        debug=DEBUG,\n        use_reloader=False,\n        allow_unsafe_werkzeug=True\n    )
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app.py b/app.py
--- a/app.py	(revision 3dcc60bfd1f21ed42580b5be23142cb62c58ae37)
+++ b/app.py	(date 1769913609921)
@@ -8,7 +8,6 @@
 # Cargar variables de entorno
 load_dotenv()
 
-# Crear aplicación Flask con carpeta static
 app = Flask(__name__, static_folder='static')
 app.config['SECRET_KEY'] = os.getenv('JWT_SECRET', 'cistem_secret_key_2025')
 
