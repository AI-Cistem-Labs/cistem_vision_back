###############################################
# MediaMTX - Configuración para Cistem Vision
# /etc/mediamtx/mediamtx.yml
###############################################

###############################################
# Configuración general
###############################################

# API REST
api: yes
apiAddress: :9997

# Logging
logLevel: info
logDestinations: [stdout]

###############################################
# Configuración RTSP
###############################################

rtspAddress: :8554
protocols: [tcp, udp]
readTimeout: 10s
writeTimeout: 10s
writeQueueSize: 512

###############################################
# Configuración HLS (CRÍTICO PARA FRONTEND)
###############################################

# Habilitar HLS
hls: yes
hlsAddress: :8888

# ✅ CAMBIO PRINCIPAL: Usar HLS estándar en lugar de lowLatency
# lowLatency requiere mínimo 7 segmentos y es más exigente
hlsVariant: mpegts

# Configuración de segmentos (valores compatibles con modo estándar)
hlsSegmentCount: 7
hlsSegmentDuration: 2s
hlsSegmentMaxSize: 50M

# CORS - Permitir acceso desde cualquier origen
hlsAllowOrigin: '*'

# IMPORTANTE: Habilitar HLS siempre (no solo on-demand)
hlsAlwaysRemux: yes

###############################################
# Configuración WebRTC
###############################################

webrtc: yes
webrtcAddress: :8889
webrtcICEServers: []

###############################################
# Configuración de paths (cámaras)
###############################################

paths:
  #-----------------------------------------
  # Configuración global para TODOS los paths
  #-----------------------------------------
  all:
    # Permitir publicación sin autenticación
    publishUser:
    publishPass:

    # Permitir lectura sin autenticación
    readUser:
    readPass:

  #-----------------------------------------
  # Cámara 1: Tapo C100 (cam_1001)
  #-----------------------------------------
  cam_1001:
    source: rtsp://admin123:admin123@192.168.1.214:554/stream1
    sourceOnDemand: yes
    runOnDemandStartTimeout: 10s
    runOnDemandCloseAfter: 10s

  # Stream procesado por IA (VisionManager publica aquí)
  cam_1001_ai:
    # Sin source - el VisionManager publica a este path
    # HLS se genera automáticamente

  #-----------------------------------------
  # Cámara 2: Tapo C310 (cam_1002)
  #-----------------------------------------
  cam_1002:
    source: rtsp://admin123:admin123@192.168.1.228:554/stream1
    sourceOnDemand: yes
    runOnDemandStartTimeout: 10s
    runOnDemandCloseAfter: 10s

  cam_1002_ai:

  #-----------------------------------------
  # Cámara 3: Tapo C210 (cam_1003)
  #-----------------------------------------
  cam_1003:
    source: rtsp://admin123:admin123@192.168.1.215:554/stream1
    sourceOnDemand: yes
    runOnDemandStartTimeout: 10s
    runOnDemandCloseAfter: 10s

  cam_1003_ai:

  #-----------------------------------------
  # Cámara 4: Tapo C500 (cam_1004)
  #-----------------------------------------
  cam_1004:
    source: rtsp://admin123:admin123@192.168.1.82:554/stream1
    sourceOnDemand: yes
    runOnDemandStartTimeout: 10s
    runOnDemandCloseAfter: 10s

  cam_1004_ai:

  #-----------------------------------------
  # Cámara 5: Tapo C320WS (cam_1005)
  #-----------------------------------------

  cam_1005:
    source: rtsp://admin123:admin123@192.168.1.157:554/stream1
    sourceOnDemand: yes
    runOnDemandStartTimeout: 10s
    runOnDemandCloseAfter: 10s

  cam_1005_ai:

  #-----------------------------------------
  # Cámara 6: Tapo C320WS (cam_1006)
  #-----------------------------------------

  cam_1006:
    source: rtsp://admin123:admin123@192.168.1.31:554/stream1
    sourceOnDemand: yes
    runOnDemandStartTimeout: 10s
    runOnDemandCloseAfter: 10s

  cam_1006_ai:


  #-----------------------------------------
  # Cámara 7: Tapo C320WS (cam_1007)
  #-----------------------------------------

  cam_1007:
    source: rtsp://admin123:admin123@192.168.1.78:554/stream1
    sourceOnDemand: yes
    runOnDemandStartTimeout: 10s
    runOnDemandCloseAfter: 10s

  cam_1007_ai: